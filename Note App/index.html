<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Note App with VCS</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }
      textarea {
        width: 100%;
        height: 300px;
        padding: 10px;
        font-size: 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: vertical;
      }
      button {
        padding: 8px 16px;
        margin: 5px;
        background: #007aff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #0066cc;
      }
      pre {
        background: #fff;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        max-height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <h1>Note App with VCS</h1>
    <textarea id="note" placeholder="Type your notes here..."></textarea>
    <br />
    <button onclick="showHistory()">Show History</button>
    <pre id="history"></pre>

    <script type="module">
      import { invoke } from '@tauri-apps/api/core';

      const noteTextarea = document.getElementById('note');
      const historyPre = document.getElementById('history');

      // Load initial content dari note.txt
      async function loadNote() {
        const content = await fetchNoteContent();
        noteTextarea.value = content || '';
      }

      // Ambil isi note.txt (opsional, kalau frontend mau baca awal)
      async function fetchNoteContent() {
        try {
          return await invoke('read_note', {});
        } catch (error) {
          return '';
        }
      }

      // Simpan dan commit saat Cmd + S
      document.addEventListener('keydown', async (e) => {
        if (e.metaKey && e.key === 's') {
          // Cmd + S di macOS
          e.preventDefault();
          try {
            const content = noteTextarea.value;
            const result = await invoke('save_and_commit', { content });
            alert(result);
            showHistory();
          } catch (error) {
            alert('Error: ' + error);
          }
        }
      });

      // Tampilkan riwayat
      async function showHistory() {
        try {
          const history = await invoke('show_history');
          historyPre.textContent = history.join('\n\n');
        } catch (error) {
          alert('Error: ' + error);
        }
      }

      // Inisialisasi saat aplikasi mulai
      loadNote();
    </script>
  </body>
</html>
